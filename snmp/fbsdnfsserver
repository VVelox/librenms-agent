#!/usr/local/bin/perl

# Add this to snmpd.conf as below.
# extend fbsdnfsserver /etc/snmp/fbsdnfsserver

use strict;
use warnings;

my $nfsstatOutput=`/usr/bin/nfsstat`;
my @nfsstatOutputA=split( /\n/, $nfsstatOutput );
my $VERSION=1;
my $int=0;

my (
	$Getattr,
	$Setattr,
	$Lookup,
	$Readlink,
	$Read,
	$Write,
	$Create,
	$Remove,
	$Rename,
	$Link,
	$Symlink,
	$Mkdir,
	$Rmdir,
	$Readdir,
	$RdirPlus,
	$Access,
	$Mknod,
	$Fsstat,
	$Fsinfo,
	$PathConf,
	$Commit,
	$RetFailed,
	$Faults,
	$Inprog,
	$Idem,
	$Nonidem,
	$Misses,
	$WriteOps,
	$WriteRPC,
	$Opsaved
	);

while( defined( $nfsstatOutputA[$int] ) ){
	$nfsstatOutputA[$int]=~s/^ +//;
	$nfsstatOutputA[$int]=~s/ +/ /g;

	if ( $int == 19 ){
		(
		 $Getattr,
		 $Setattr,
		 $Lookup,
		 $Readlink,
		 $Read,
		 $Write,
		 $Create,
		 $Remove,
		)=split( /\ /, $nfsstatOutputA[$int] );
	
	}

	if ( $int == 21 ){
		(
		 $Rename,
		 $Link,
		 $Symlink,
		 $Mkdir,
		 $Rmdir,
		 $Readdir,
		 $RdirPlus,
		 $Access
		)=split( /\ /, $nfsstatOutputA[$int] );
	
	}

	if ( $int == 23 ){
		(
		 $Mknod,
		 $Fsstat,
		 $Fsinfo,
		 $PathConf,
		 $Commit
		)=split( /\ /, $nfsstatOutputA[$int] );
	
	}

	if ( $int == 25 ){
		(
		 $RetFailed
		)=split( /\ /, $nfsstatOutputA[$int] );
	
	}

	if ( $int == 27 ){
		(
		 $Faults
		)=split( /\ /, $nfsstatOutputA[$int] );
	
	}

	if ( $int == 30 ){
		(
		 $Inprog,
		 $Idem,
		 $Nonidem,
		 $Misses
		)=split( /\ /, $nfsstatOutputA[$int] );
	
	}

	if ( $int == 33 ){
		(
		 $WriteOps,
		 $WriteRPC,
		 $Opsaved
		)=split( /\ /, $nfsstatOutputA[$int] );
		
	}
	
	$int++;
}

print "{\"Getattr\":\"".$Getattr."\",\n".
	"\"Setattr\":\"".$Setattr."\",\n".
	"\"Lookup\":\"".$Lookup."\",\n".
	"\"Readlink\":\"".$Readlink."\",\n".
	"\"Read\":\"".$Read."\",\n".
	"\"Write\":\"".$Write."\",\n".
	"\"Create\":\"".$Create."\",\n".
	"\"Remove\":\"".$Remove."\",\n".
	"\"Rename\":\"".$Rename."\",\n".
	"\"Link\":\"".$Link."\",\n".
	"\"SymLink\":\"".$Symlink."\",\n".
	"\"Mkdir\":\"".$Mkdir."\",\n".
	"\"Rmdir\":\"".$Rmdir."\",\n".
	"\"Readdir\":\"".$Readdir."\",\n".
	"\"RdirPlus\":\"".$RdirPlus."\",\n".
	"\"Access\":\"".$Access."\",\n".
	"\"Mknod\":\"".$Mknod."\",\n".
	"\"Fsstat\":\"".$Fsstat."\",\n".
	"\"Fsinfo\":\"".$Fsinfo."\",\n".
	"\"PathConf\":\"".$PathConf."\",\n".
	"\"Commit\":\"".$Commit."\",\n".
	"\"RetFailed\":\"".$RetFailed."\",\n".
	"\"Faults\":\"".$Faults."\",\n".
	"\"Inprog\":\"".$Inprog."\",\n".
	"\"Idem\":\"".$Idem."\",\n".
	"\"Nonidem\":\"".$Nonidem."\",\n".
	"\"Misses\":\"".$Misses."\",\n".
	"\"WriteOps\":\"".$WriteOps."\",\n".
	"\"WriteRPC\":\"".$WriteRPC."\",\n".
	"\"Opsaved\":\"".$Opsaved."\",\n".
	"\"error\":\"0\",\n\"errorString\"\:\"\",\n\"version\":\"".$VERSION."\"}\n";
