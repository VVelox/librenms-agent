#!usr/bin/env perl

# Add this to snmpd.conf as below.
# extend fbsdnfsclient /etc/snmp/fbsdnfsclient

use strict;
use warnings;

my $nfsstatOutput=`/usr/bin/nfsstat`;
my @nfsstatOutputA=split( /\n/, $nfsstatOutput );
my $VERSION=1;
my $int=0;

my (
	$Getattr,
	$Setattr,   
	$Lookup,
	$Readlink,
	$Read,
	$Write,
	$Create,
	$Remove,
	$Rename,
	$Link,
	$Symlink,
	$Mkdir,
	$Rmdir,
	$Readdir,
	$RdirPlus,
	$Access,
	$Mknod,
	$Fsstat,
	$Fsinfo,
	$PathConf,
	$Commit,
	$TimedOut,
	$Invalid,
	$XReplies,
	$Retries,
	$Requests,
	$AttrHits,
	$AttrMisses,
	$LkupHits,
	$LkupMisses,
	$BioRHits,
	$BioRMisses,
	$BioWHits,
	$BioWMisses,
	$BioRLHits,
	$BioRLMisses,
	$BioDHits,
	$BioDMisses,
	$DirEHits,
	$DirEMisses,
	$AccsHits,
	$AccsMisses,
	);

while( defined( $nfsstatOutputA[$int] ) ){
	$nfsstatOutputA[$int]=~s/^ +//;
	$nfsstatOutputA[$int]=~s/ +/ /g;

	if ( $int == 3 ){
		(
		 $Getattr,
		 $Setattr,   
		 $Lookup,
		 $Readlink,
		 $Read,
		 $Write,
		 $Create,
		 $Remove,
		)=split( /\ /, $nfsstatOutputA[$int] );
	
	}

	if ( $int == 5 ){
		(
		 $Rename,
		 $Link,
		 $Symlink,
		 $Mkdir,
		 $Rmdir,
		 $Readdir,
		 $RdirPlus,
		 $Access,
		)=split( /\ /, $nfsstatOutputA[$int] );
	
	}

	if ( $int == 7 ){
		(
		 $Mknod,
		 $Fsstat,
		 $Fsinfo,
		 $PathConf,
		 $Commit,
		)=split( /\ /, $nfsstatOutputA[$int] );
	
	}

	if ( $int == 10 ){
		(
		 $TimedOut,
		 $Invalid,
		 $XReplies,
		 $Retries,
		 $Requests,
		)=split( /\ /, $nfsstatOutputA[$int] );
	
	}

	if ( $int == 13 ){
		(
		 $AttrHits,
		 $AttrMisses,
		 $LkupHits,
		 $LkupMisses,
		 $BioRHits,
		 $BioRMisses,
		 $BioWHits,
		 $BioWMisses,
		)=split( /\ /, $nfsstatOutputA[$int] );
	
	}

	if ( $int == 15 ){
		(
		 $BioRLHits,
		 $BioRLMisses,
		 $BioDHits,
		 $BioDMisses,
		 $DirEHits,
		 $DirEMisses,
		 $AccsHits,
		 $AccsMisses,
		)=split( /\ /, $nfsstatOutputA[$int] );
	
	}
	
	$int++;
}

print "{\"data\":{\"Getattr\":\"".$Getattr."\",\n".
	"\"Setattr\":\"".$Setattr."\",\n".
	"\"Lookup\":\"".$Lookup."\",\n".
	"\"Readlink\":\"".$Readlink."\",\n".
	"\"Read\":\"".$Read."\",\n".
	"\"Write\":\"".$Write."\",\n".
	"\"Create\":\"".$Create."\",\n".
	"\"Remove\":\"".$Remove."\",\n".
	"\"Rename\":\"".$Rename."\",\n".
	"\"Link\":\"".$Link."\",\n".
	"\"SymLink\":\"".$Symlink."\",\n".
	"\"Mkdir\":\"".$Mkdir."\",\n".
	"\"Rmdir\":\"".$Rmdir."\",\n".
	"\"Readdir\":\"".$Readdir."\",\n".
	"\"RdirPlus\":\"".$RdirPlus."\",\n".
	"\"Access\":\"".$Access."\",\n".
	"\"Mknod\":\"".$Mknod."\",\n".
	"\"Fsstat\":\"".$Fsstat."\",\n".
	"\"Fsinfo\":\"".$Fsinfo."\",\n".
	"\"PathConf\":\"".$PathConf."\",\n".
	"\"Commit\":\"".$Commit."\",\n".
	"\"Timedout\":\"".$TimedOut."\",\n".
	"\"Invalid\":\"".$Invalid."\",\n".
	"\"XReplies\":\"".$XReplies."\",\n".
	"\"Retries\":\"".$Retries."\",\n".
	"\"Requests\":\"".$Requests."\",\n".
	"\"AttrHits\":\"".$AttrHits."\",\n".
	"\"AttrMisses\":\"".$AttrMisses."\",\n".
	"\"LkupHits\":\"".$LkupHits."\",\n".
	"\"LkupMisses\":\"".$LkupMisses."\",\n".
	"\"BioRHits\":\"".$BioRHits."\",\n".
	"\"BioRMisses\":\"".$BioRMisses."\",\n".
	"\"BioWHits\":\"".$BioWHits."\",\n".
	"\"BioWMisses\":\"".$BioWMisses."\",\n".
	"\"BioRLHits\":\"".$BioRLHits."\",\n".
	"\"BioRLMisses\":\"".$BioRLMisses."\",\n".
	"\"BioDHits\":\"".$BioDHits."\",\n".
	"\"BioDMisses\":\"".$BioDMisses."\",\n".
	"\"DirEHits\":\"".$DirEHits."\",\n".
	"\"DirEMisses\":\"".$DirEMisses."\",\n".
	"\"AccsHits\":\"".$AccsHits."\",\n".
	"\"AccsMisses\":\"".$AccsMisses."\"},\n".
	"\"error\":\"0\",\n\"errorString\"\:\"\",\n\"version\":\"".$VERSION."\"}\n";
